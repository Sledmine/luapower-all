<h2 id="local-utf8-requireutf8"><code>local utf8 = require'utf8'</code></h2>
<p>Decode and encode UTF-8 data with control over invalid bytes.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>utf8.next(buf, len, i) -&gt; ni, code, byte</code></td>
<td style="text-align: left;">codepoint (or invalid byte) at index <code>i</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>utf8.prev(buf, len, i) -&gt; ni, code, byte</code></td>
<td style="text-align: left;">codepoint (or invalid byte) before index <code>i</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>utf8.decode(buf, len, out, outlen, repl) -&gt; [out, ]n, p</code></td>
<td style="text-align: left;">decode utf-8 buffer (or get output length)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>utf8.encode(buf, len, out, outlen, repl) -&gt; [out, ]bytes</code></td>
<td style="text-align: left;">encode utf-32 buffer (or get output length)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>utf8.chars(s[, start]) -&gt; iter() -&gt; ni, code, byte</code></td>
<td style="text-align: left;">iterate codepoints in string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>utf8.encode_chars({c1,...}, repl | c1,...) -&gt; s</code></td>
<td style="text-align: left;">encode codepoints to utf-8 string</td>
</tr>
</tbody>
</table>
<h3 id="utf8.nextbuf-len-i---next_i-code-byte-nil"><code>utf8.next(buf, len, i) -&gt; next_i, code, byte | nil</code></h3>
<p>Return codepoint (or invalid byte) at index <code>i</code>. Return <code>nil</code> if <code>i &gt;= len</code>.</p>
<h3 id="utf8.prevbuf-len-i---i-code-byte-nil"><code>utf8.prev(buf, len, i) -&gt; i, code, byte | nil</code></h3>
<p>Return codepoint (or invalid byte) before index <code>i</code>. Return <code>nil</code> if <code>i &lt;= 0</code>.</p>
<h3 id="utf8.decodebuf-len-out-outlen-repl---out-n-p"><code>utf8.decode(buf, len, out, outlen, repl) -&gt; [out, ]n, p</code></h3>
<p>Decode utf8 buffer into a utf32 buffer or get output length.</p>
<ul>
<li>if <code>out</code> is <code>nil</code> the output buffer is allocated by the function.
<ul>
<li>the buffer is n+1 codepoints thus null-terminated.</li>
</ul></li>
<li>if <code>out</code> is <code>false</code> the output buffer is not allocated or returned.</li>
<li><code>n, p</code> is the number of valid codepoints and the number of invalid bytes.</li>
<li><code>repl</code> is an optional codepoint to replace invalid bytes with.
<ul>
<li>if <code>repl</code> is not given, invalid bytes are skipped.</li>
<li>if <code>repl</code> is <code>'iso-8859-1'</code>, invalid bytes are treated as iso-8859-1 characters like browsers do.</li>
<li>replaced invalid bytes are counted in <code>n</code>.</li>
</ul></li>
<li>returns <code>nil, 'overflow', sz</code> on output buffer overflow, where <code>sz</code> is the byte size of the text that fit into the buffer.</li>
</ul>
<h3 id="utf8.encodebuf-len-out-outlen-repl---out-bytes"><code>utf8.encode(buf, len, out, outlen, repl) -&gt; [out, ]bytes</code></h3>
<p>Encode utf32 buffer into a utf8 buffer or get output length.</p>
<ul>
<li>if <code>out</code> is <code>nil</code> the output buffer is allocated by the function.
<ul>
<li>the buffer is n+1 bytes thus null-terminated.</li>
</ul></li>
<li>if <code>out</code> is <code>false</code> the output buffer is not allocated or returned.</li>
<li><code>repl</code> is an optional valid codepoint to replace invalid codepoints with.
<ul>
<li>if <code>repl</code> is not given, invalid codepoints are skipped.</li>
</ul></li>
<li>returns <code>nil, 'overflow'</code> on error (output buffer overflow).</li>
</ul>
<h3 id="utf8.charss-start---iter---next_i-code-byte"><code>utf8.chars(s[, start]) -&gt; iter() -&gt; next_i, code, byte</code></h3>
<p>Iterate all the codepoints in a string, returning the index in string where the <em>next</em> codepoint is, and the codepoint. Invalid bytes are returned in the second return value, in which case the codepoint is <code>nil</code>.</p>
<h3 id="utf8.encode_charsc1-...-repl---s-utf8.encode_charsc1-...---s"><code>utf8.encode_chars({c1, ...}, repl) -&gt; s</code> <br> <code>utf8.encode_chars(c1, ...) -&gt; s</code></h3>
<p>Encode codepoints (given as an array or as separate args) to a utf-8 string.</p>
