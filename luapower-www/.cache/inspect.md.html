<h2 id="requireinspectt-options"><code>require'inspect'(t[, options])</code></h2>
<p>Dumps Lua tables in human-readable format. The output is for debugging, not serialization (use <a href="/pp">pp</a> for that).</p>
<p>Features:</p>
<ul>
<li>array-like tables are rendered horizontally.</li>
<li>dictionary-like tables are rendered with one element per line.</li>
<li>mixed tables have the array part on the first line, and the dictionary part just below.</li>
<li>keys are sorted alphanumerically when possible.</li>
<li>subtables are indented with two spaces per level (configurable).</li>
<li>functions, userdata and cdata print as <code>&lt;function x&gt;</code>, <code>&lt;userdata x&gt;</code>, etc.</li>
<li>metatables are added at the end, in a special field called <code>&lt;metatable&gt;</code>.</li>
<li>handles recursive references: prints <code>&lt;id&gt;</code> right before the table is printed out the first time, and replaces the whole table with <code>&lt;table id&gt;</code> from then on, preventing infinite loops.</li>
</ul>
<h3 id="options">Options</h3>
<ul>
<li><code>options.depth</code>: sets the maximum depth that will be printed out before printing just <code>{...}</code>:</li>
<li><code>options.newline</code> &amp; <code>options.indent</code>: strings to use as newline and indent.</li>
<li><code>options.process</code>: filter/format function.</li>
<li><code>options.process</code>: <code>function(item, path)</code> where:
<ul>
<li><code>item</code> is either a key or a value on the table, or any of its subtables</li>
<li><code>path</code> is an array-like table built with all the keys that have been used to reach <code>item</code>, from the root.</li>
<li>For values, it is just a regular list of keys. For example, to reach the 1 in <code>{a = {b = 1}}</code>, the <code>path</code> will be <code>{'a', 'b'}</code></li>
<li>For keys, the special value <code>inspect.KEY</code> is inserted. For example, to reach the <code>c</code> in <code>{a = {b = {c = 1}}}</code>, the path will be <code>{'a', 'b', 'c', inspect.KEY }</code></li>
<li>For metatables, the special value <code>inspect.METATABLE</code> is inserted. For <code>{a = {b = 1}}}</code>, the path <code>{'a', {b = 1}, inspect.METATABLE}</code> means “the metatable of the table <code>{b = 1}</code>”.</li>
<li><code>processed_item</code> is the value returned by <code>options.process</code>. If it is equal to <code>item</code>, then the inspected table will look unchanged. If it is different, then the table will look different; most notably, if it’s <code>nil</code>, the item will dissapear on the inspected table.</li>
</ul></li>
</ul>
<h4 id="filtering-examples">Filtering Examples</h4>
<p>Remove a particular metatable from the result:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">local</span> t <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">}</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">local</span> mt <span class="op">=</span> <span class="op">{</span>b <span class="op">=</span> <span class="dv">2</span><span class="op">}</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">setmetatable</span><span class="op">(</span>t<span class="op">,</span> mt<span class="op">)</span></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">local</span> remove_mt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>item<span class="op">)</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="cf">if</span> item <span class="op">~=</span> mt <span class="cf">then</span> <span class="cf">return</span> item <span class="cf">end</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="cf">end</span></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">-- mt does not appear</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">assert</span><span class="op">(</span>inspect<span class="op">(</span>t<span class="op">,</span> <span class="op">{</span>process <span class="op">=</span> remove_mt<span class="op">})</span> <span class="op">==</span> <span class="st">&quot;{ 1, 2, 3 }&quot;</span><span class="op">)</span></span></code></pre></div>
<p>The previous exaple only works for a particular metatable. If you want to make <em>all</em> metatables, you can use the <code>path</code> parameter to check wether the last element is <code>inspect.METATABLE</code>, and return <code>nil</code> instead of the item:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">local</span> t<span class="op">,</span> mt <span class="op">=</span> <span class="op">...</span> <span class="co">-- (defined as before)</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">local</span> remove_all_metatables <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>item<span class="op">,</span> path<span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="cf">if</span> path<span class="op">[#</span>path<span class="op">]</span> <span class="op">~=</span> inspect<span class="op">.</span><span class="cn">METATABLE</span> <span class="cf">then</span> <span class="cf">return</span> item <span class="cf">end</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="cf">end</span></span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="fu">assert</span><span class="op">(</span>inspect<span class="op">(</span>t<span class="op">,</span> <span class="op">{</span>process <span class="op">=</span> remove_all_metatables<span class="op">})</span> <span class="op">==</span> <span class="st">&quot;{ 1, 2, 3 }&quot;</span><span class="op">)</span></span></code></pre></div>
<p>Filter a value:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">local</span> anonymize_password <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>item<span class="op">,</span> path<span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="cf">if</span> path<span class="op">[#</span>path<span class="op">]</span> <span class="op">==</span> <span class="st">&#39;password&#39;</span> <span class="cf">then</span> <span class="cf">return</span> <span class="st">&quot;XXXX&quot;</span> <span class="cf">end</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="cf">return</span> item</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="cf">end</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">local</span> info <span class="op">=</span> <span class="op">{</span>user <span class="op">=</span> <span class="st">&#39;peter&#39;</span><span class="op">,</span> password <span class="op">=</span> <span class="st">&#39;secret&#39;</span><span class="op">}</span></span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="fu">assert</span><span class="op">(</span>inspect<span class="op">(</span>info<span class="op">,</span> <span class="op">{</span>process <span class="op">=</span> anonymize_password<span class="op">})</span> <span class="op">==</span> <span class="vs">[[{</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="vs">  password = &quot;XXXX&quot;,</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="vs">  user     = &quot;peter&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="vs">}]])</span></span></code></pre></div>
