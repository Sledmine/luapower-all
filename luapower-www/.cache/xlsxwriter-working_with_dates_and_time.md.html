<h1 id="working_with_dates_and_time">Working with Dates and Time</h1>
<p>Dates and times in Excel are represented by real numbers. For example a date that is displayed in Excel as "Jan 1 2013 12:00 PM" is stored as the number 41275.5.</p>
<p>The integer part of the number stores the number of days since the epoch, which is generally 1900, and the fractional part stores the percentage of the day.</p>
<p>A date or time in Excel is just like any other number. To display the number as a date you must apply an Excel number format to it. Here are some examples:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">local</span> Workbook <span class="op">=</span> <span class="fu">require</span> <span class="st">&quot;xlsxwriter.workbook&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">local</span> workbook  <span class="op">=</span> Workbook<span class="op">:</span>new<span class="op">(</span><span class="st">&quot;date_examples.xlsx&quot;</span><span class="op">)</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">local</span> worksheet <span class="op">=</span> workbook<span class="op">:</span>add_worksheet<span class="op">()</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">-- Widen the first column or extra visibility.</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>worksheet<span class="op">:</span>set_column<span class="op">(</span><span class="st">&quot;A:A&quot;</span><span class="op">,</span> <span class="dv">30</span><span class="op">)</span></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">-- A number to convert to a date.</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">local</span> number <span class="op">=</span> <span class="dv">41333.5</span></span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">-- Write it as a number without formatting.</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A1&quot;</span><span class="op">,</span> number<span class="op">)</span>          <span class="co">--&gt; 41333.5</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw">local</span> format2 <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>num_format <span class="op">=</span> <span class="st">&quot;dd/mm/yy&quot;</span><span class="op">})</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A2&quot;</span><span class="op">,</span> number<span class="op">,</span> format2<span class="op">)</span> <span class="co">--&gt; 28/02/13</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="kw">local</span> format3 <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>num_format <span class="op">=</span> <span class="st">&quot;mm/dd/yy&quot;</span><span class="op">})</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A3&quot;</span><span class="op">,</span> number<span class="op">,</span> format3<span class="op">)</span> <span class="co">--&gt; 02/28/13</span></span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="kw">local</span> format4 <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>num_format <span class="op">=</span> <span class="st">&quot;d-m-yyyy&quot;</span><span class="op">})</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A4&quot;</span><span class="op">,</span> number<span class="op">,</span> format4<span class="op">)</span> <span class="co">--&gt; 28-2-2013</span></span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="kw">local</span> format5 <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>num_format <span class="op">=</span> <span class="st">&quot;dd/mm/yy hh:mm&quot;</span><span class="op">})</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A5&quot;</span><span class="op">,</span> number<span class="op">,</span> format5<span class="op">)</span> <span class="co">--&gt; 28/02/13 12:00</span></span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="kw">local</span> format6 <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>num_format <span class="op">=</span> <span class="st">&quot;d mmm yyyy&quot;</span><span class="op">})</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A6&quot;</span><span class="op">,</span> number<span class="op">,</span> format6<span class="op">)</span> <span class="co">--&gt; 28 Feb 2013</span></span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="kw">local</span> format7 <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>num_format <span class="op">=</span> <span class="st">&quot;mmm d yyyy hh:mm AM/PM&quot;</span><span class="op">})</span></span>
<span id="cb1-31"><a href="#cb1-31"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A7&quot;</span><span class="op">,</span> number<span class="op">,</span> format7<span class="op">)</span> <span class="co">--&gt; Feb 28 2008 12:00 PM</span></span>
<span id="cb1-32"><a href="#cb1-32"></a></span>
<span id="cb1-33"><a href="#cb1-33"></a>workbook<span class="op">:</span><span class="fu">close</span><span class="op">()</span></span></code></pre></div>
<p><img src="xlsxwriter/_images/working_with_dates_and_times01.png" /></p>
<p>To make working with dates and times a little easier the <code>xlsxwriter</code> module provides two date handling methods: <code class="interpreted-text" role="func">write_date_time</code> and <code class="interpreted-text" role="func">write_date_string</code>.</p>
<p>The <code class="interpreted-text" role="func">write_date_time</code> method takes a table of values like those used for <a href="http://www.lua.org/manual/5.2/manual.html#pdf-os.time">os.time()</a> :</p>
<pre><code> date_format = workbook:add_format({num_format = &quot;d mmmm yyyy&quot;})

 worksheet:write_date_time(&quot;A1&quot;, {year = 2014, month = 3, day = 17}, date_format)</code></pre>
<p>The allowable table keys and values are:</p>
<table style="width:33%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Key</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">year</td>
<td style="text-align: left;">4 digit year</td>
</tr>
<tr class="even">
<td style="text-align: left;">month</td>
<td style="text-align: left;">1 - 12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">day</td>
<td style="text-align: left;">1 - 31</td>
</tr>
<tr class="even">
<td style="text-align: left;">hour</td>
<td style="text-align: left;">0 - 23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">min</td>
<td style="text-align: left;">0 - 59</td>
</tr>
<tr class="even">
<td style="text-align: left;">sec</td>
<td style="text-align: left;">0 - 59.999</td>
</tr>
</tbody>
</table>
<p>The <code class="interpreted-text" role="func">write_date_string</code> method takes a string in an ISO8601 format:</p>
<pre><code> yyyy-mm-ddThh:mm:ss.sss</code></pre>
<p>This conforms to an ISO8601 date but it should be noted that the full range of ISO8601 formats are not supported. The following variations are permitted:</p>
<pre><code> yyyy-mm-ddThh:mm:ss.sss         -- Standard format.
 yyyy-mm-ddThh:mm:ss.sssZ        -- Additional Z (but not time zones).
 yyyy-mm-dd                      -- Date only, no time.
            hh:mm:ss.sss         -- Time only, no date.
            hh:mm:ss             -- No fractional seconds.</code></pre>
<p>Note that the T is required for cases with both date, and time and seconds are required for all times.</p>
<p>Here is an example using <code>write_date_string()</code>:</p>
<pre><code> date_format = workbook:add_format({num_format = &quot;d mmmm yyyy&quot;})

 worksheet:write_date_string(&quot;A1&quot;, &quot;2014-03-17&quot;, date_format)</code></pre>
<p>Here is a longer example that displays the same date in a several different formats:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">local</span> Workbook <span class="op">=</span> <span class="fu">require</span> <span class="st">&quot;xlsxwriter.workbook&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">local</span> workbook  <span class="op">=</span> Workbook<span class="op">:</span>new<span class="op">(</span><span class="st">&quot;datetimes.xlsx&quot;</span><span class="op">)</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">local</span> worksheet <span class="op">=</span> workbook<span class="op">:</span>add_worksheet<span class="op">()</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">local</span> bold      <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>bold <span class="op">=</span> <span class="kw">true</span><span class="op">})</span></span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">-- Expand the first columns so that the date is visible.</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>worksheet<span class="op">:</span>set_column<span class="op">(</span><span class="st">&quot;A:B&quot;</span><span class="op">,</span> <span class="dv">30</span><span class="op">)</span></span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">-- Write the column headers.</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;A1&quot;</span><span class="op">,</span> <span class="st">&quot;Formatted date&quot;</span><span class="op">,</span> bold<span class="op">)</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>worksheet<span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="st">&quot;B1&quot;</span><span class="op">,</span> <span class="st">&quot;Format&quot;</span><span class="op">,</span>         bold<span class="op">)</span></span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">-- Create an ISO8601 style date string to use in the examples.</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="kw">local</span> date_string <span class="op">=</span> <span class="st">&quot;2013-01-23T12:30:05.123&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">-- Examples date and time formats. In the output file compare how changing</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">-- the format codes change the appearance of the date.</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="kw">local</span> date_formats <span class="op">=</span> <span class="op">{</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>  <span class="st">&quot;dd/mm/yy&quot;</span><span class="op">,</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>  <span class="st">&quot;mm/dd/yy&quot;</span><span class="op">,</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>  <span class="st">&quot;dd m yy&quot;</span><span class="op">,</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>  <span class="st">&quot;d mm yy&quot;</span><span class="op">,</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>  <span class="st">&quot;d mmm yy&quot;</span><span class="op">,</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>  <span class="st">&quot;d mmmm yy&quot;</span><span class="op">,</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>  <span class="st">&quot;d mmmm yyy&quot;</span><span class="op">,</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>  <span class="st">&quot;d mmmm yyyy&quot;</span><span class="op">,</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>  <span class="st">&quot;dd/mm/yy hh:mm&quot;</span><span class="op">,</span></span>
<span id="cb6-29"><a href="#cb6-29"></a>  <span class="st">&quot;dd/mm/yy hh:mm:ss&quot;</span><span class="op">,</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>  <span class="st">&quot;dd/mm/yy hh:mm:ss.000&quot;</span><span class="op">,</span></span>
<span id="cb6-31"><a href="#cb6-31"></a>  <span class="st">&quot;hh:mm&quot;</span><span class="op">,</span></span>
<span id="cb6-32"><a href="#cb6-32"></a>  <span class="st">&quot;hh:mm:ss&quot;</span><span class="op">,</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>  <span class="st">&quot;hh:mm:ss.000&quot;</span><span class="op">,</span></span>
<span id="cb6-34"><a href="#cb6-34"></a><span class="op">}</span></span>
<span id="cb6-35"><a href="#cb6-35"></a></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="co">-- Write the same date and time using each of the above formats.</span></span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="cf">for</span> row<span class="op">,</span> date_format_str <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span>date_formats<span class="op">)</span> <span class="cf">do</span></span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a>  <span class="co">-- Create a format for the date or time.</span></span>
<span id="cb6-40"><a href="#cb6-40"></a>  <span class="kw">local</span> date_format <span class="op">=</span> workbook<span class="op">:</span>add_format<span class="op">({</span>num_format <span class="op">=</span> date_format_str<span class="op">,</span></span>
<span id="cb6-41"><a href="#cb6-41"></a>                                           align <span class="op">=</span> <span class="st">&quot;left&quot;</span><span class="op">})</span></span>
<span id="cb6-42"><a href="#cb6-42"></a></span>
<span id="cb6-43"><a href="#cb6-43"></a>  <span class="co">-- Write the same date using different formats.</span></span>
<span id="cb6-44"><a href="#cb6-44"></a>  worksheet<span class="op">:</span>write_date_string<span class="op">(</span>row<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> date_string<span class="op">,</span> date_format<span class="op">)</span></span>
<span id="cb6-45"><a href="#cb6-45"></a></span>
<span id="cb6-46"><a href="#cb6-46"></a>  <span class="co">-- Also write the format string for comparison.</span></span>
<span id="cb6-47"><a href="#cb6-47"></a>  worksheet<span class="op">:</span>write_string<span class="op">(</span>row<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> date_format_str<span class="op">)</span></span>
<span id="cb6-48"><a href="#cb6-48"></a></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="cf">end</span></span>
<span id="cb6-50"><a href="#cb6-50"></a></span>
<span id="cb6-51"><a href="#cb6-51"></a>workbook<span class="op">:</span><span class="fu">close</span><span class="op">()</span></span></code></pre></div>
<p><img src="/files/luapower/xlsxwriter/_images/working_with_dates_and_times02.png" /></p>
