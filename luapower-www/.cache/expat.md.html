<h2 id="local-expat-requireexpat"><code>local expat = require'expat'</code></h2>
<p>A ffi binding for the <a href="http://expat.sourceforge.net/">Expat XML parser</a>.</p>
<h2 id="api">API</h2>
<h3 id="expat.parsesource-callbacks"><code>expat.parse(source, callbacks)</code></h3>
<p>Parse a XML from a string, cdata, file, or reader function, calling a callback for each piece of the XML parsed.</p>
<p>The optional <code>namespacesep</code> field is a single-character string. If present, it causes XML namespaces to be resolved during parsing. Namespace URLs are then concatenated to tag names using the specified character.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1"></a>source <span class="op">=</span> <span class="op">{</span>path <span class="op">=</span> <span class="cn">S</span><span class="op">}</span> <span class="op">|</span> <span class="op">{</span>string <span class="op">=</span> <span class="cn">S</span><span class="op">}</span> <span class="op">|</span> <span class="op">{</span>cdata <span class="op">=</span> <span class="cn">CDATA</span><span class="op">,</span> size <span class="op">=</span> <span class="cn">N</span><span class="op">}</span> <span class="op">|</span> <span class="op">{</span><span class="fu">read</span> <span class="op">=</span> read_function<span class="op">}</span> <span class="op">&amp;</span> <span class="op">{[</span>namespacesep<span class="op">=</span><span class="cn">S</span><span class="op">]}</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>callbacks <span class="op">=</span> <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  element         <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> model<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  attr_list       <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>elem<span class="op">,</span> name<span class="op">,</span> <span class="fu">type</span><span class="op">,</span> dflt<span class="op">,</span> is_required<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  xml             <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>version<span class="op">,</span> encoding<span class="op">,</span> standalone<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  entity          <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> is_param_entity<span class="op">,</span> val<span class="op">,</span> base<span class="op">,</span> sysid<span class="op">,</span> pubid<span class="op">,</span> notation<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>  start_tag       <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> attrs<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="cf">end</span>_tag         <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  cdata           <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>s<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  pi              <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>target<span class="op">,</span> data<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  comment         <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>s<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  start_cdata     <span class="op">=</span> <span class="kw">function</span><span class="op">()</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="cf">end</span>_cdata       <span class="op">=</span> <span class="kw">function</span><span class="op">()</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>  default         <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>s<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>  default_expand  <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>s<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>  start_doctype   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> sysid<span class="op">,</span> pubid<span class="op">,</span> has_internal_subset<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="cf">end</span>_doctype     <span class="op">=</span> <span class="kw">function</span><span class="op">()</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>  unparsed        <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> base<span class="op">,</span> sysid<span class="op">,</span> pubid<span class="op">,</span> notation<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>  notation        <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> base<span class="op">,</span> sysid<span class="op">,</span> pubid<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>  start_namespace <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>prefix<span class="op">,</span> uri<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="cf">end</span>_namespace   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>prefix<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>  not_standalone  <span class="op">=</span> <span class="kw">function</span><span class="op">()</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>  ref             <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>parser<span class="op">,</span> context<span class="op">,</span> base<span class="op">,</span> sysid<span class="op">,</span> pubid<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>  skipped         <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> is_parameter_entity<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26"></a>  unknown         <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>name<span class="op">,</span> info<span class="op">)</span> <span class="cf">end</span><span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="op">}</span></span></code></pre></div>
<h3 id="expat.treeparsesource-known_tags---root_node"><code>expat.treeparse(source, [known_tags]) -&gt; root_node</code></h3>
<p>Parse a XML to a tree of nodes. known_tags filters the output so that only the tags that known_tags indexes are returned.</p>
<p>Nodes look like this:</p>
<pre><code>node = {tag=, attrs={&lt;k&gt;=v}, children={node1,...}, tags={&lt;tag&gt; = node}, cdata=, parent=}</code></pre>
<h3 id="expat.childrennode-tag---iter---node"><code>expat.children(node, tag) -&gt; iter() -&gt; node</code></h3>
<p>Iterate a nodeâ€™s children that have a specific tag.</p>
