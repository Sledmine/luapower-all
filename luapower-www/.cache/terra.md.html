<h2 id="local-terra-requireterra"><code>local terra = require'terra'</code></h2>
<p>This is a slightly modified build of the <a href="http://terralang.org">Terra</a> library which allows the Terra runtime to be loaded from Lua as a Lua/C module. The terra module exposes the complete Terra Lua API and installs a require() loader for loading .t files from the same locations that are used for loading Lua files.</p>
<p><strong>NOTE:</strong> Terra only runs on x86-64!</p>
<p><strong>NOTE:</strong> On Windows Terra is compiled with luapower’s mingw64 toolchain so there’s no need to install Visual Studio to use standard C headers. Instead, mingw64 headers are provided in the <a href="/mingw64-headers">mingw64-headers</a> package.</p>
<p><strong>NOTE:</strong> The CUDA backend is not available in this build.</p>
<h2 id="building">Building</h2>
<p>Building terra requires <a href="/llvm">llvm</a>.</p>
<h2 id="bundling">Bundling</h2>
<p><a href="/bundle">Bundling</a> terra requires bunding in the <a href="/llvm">llvm</a> static libraries. There’s a script documenting what these are that can be used with bundle directly:</p>
<pre><code>bundle ... -a terra -a &quot;$(csrc/terra/bundle-libs)&quot;</code></pre>
<h2 id="changes-to-terra">Changes to terra</h2>
<p>The <a href="https://github.com/luapower/terra_fork/compare/0a11f98...luapower:master">source code changes</a> made to terra were kept to a minimum to make it easy to to merge <a href="https://github.com/luapower/terra_fork/compare/0a11f98...zdevito:master">upstream changes</a> back into the luapower terra fork. This is similar to how <a href="/dynasm">dynasm</a> was modified for luapower. Anyway, the changelist:</p>
<ul>
<li>the <code>terra</code> dynamic lib does not bundle luajit and is instead exposed as a normal Lua/C module that must be included with <code>require'terra'</code> from Lua.</li>
<li>LuaJIT was modified to <code>require'terra'</code> if loading a <code>*.t</code> file, and to load the file via <code>_G.loadfile</code> instead of <code>lua_loadfile</code>.</li>
<li><code>terralib.lua</code> was changed to load <code>terralib_luapower.lua</code> at the end of the file, which changes the following:
<ul>
<li><code>loadfile</code> is overloaded to call <code>terra.loadfile</code> for <code>*.t</code> files.</li>
<li><code>terralib.terrahome</code> is set to <code>package.exedir</code>.</li>
<li><code>package.terrapath</code> is set to match <code>package.path</code>.</li>
<li><code>terralib.linklibrary</code> is modified to also accept <code>foo</code> for <code>libfoo.so</code> and <code>libfoo.dylib</code> respectively, just like <code>ffi.load</code> does.</li>
</ul></li>
<li><code>terralib.lua</code>, <code>asdl.lua</code> and <code>terralist.lua</code> are not bundled into the binary and are provided separately.</li>
<li><code>strict.lua</code> is not loaded and not included (it’s included with <a href="/luajit">luajit</a> and must be loaded manually as needed).</li>
<li><code>std.t</code> and <code>parsing.t</code> were renamed <code>terra/std.t</code> and <code>terra/parsing.t</code> respectively and are now in the luapower dir along with all Lua files.</li>
<li>the system include paths for Windows are set for <a href="/mingw64-headers">mingw64-headers</a> so building binaries with Terra’s API works out-of-the-box providing the <a href="/building">luapower toolchain</a> is installed (needed for linking).</li>
</ul>
