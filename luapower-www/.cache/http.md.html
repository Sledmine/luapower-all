<h2 id="local-http-requirehttp"><code>local http = require'http'</code></h2>
<p>HTTP 1.1 client &amp; server protocol in Lua.</p>
<p>Works on an abstract I/O API made of three functions:</p>
<pre><code>* `http:read(buf, maxsz) -&gt; sz | nil,&#39;closed&#39;|err`
* `http:send(s | buf,sz) -&gt; true | nil,err`
* `http:close()`</code></pre>
<p>GZip compression can be enabled with <code>http.zlib = require'zlib'</code>.</p>
<h2 id="status">Status</h2>
<p><warn>Work-in-progress.<warn></p>
<h2 id="api">API</h2>
<p><code>http:new(opt) -&gt; http</code></p>
<p>Create a HTTP protocol object that should be used on a single freshly open HTTP or HTTPS connection to either perform HTTP requests on it (as client) or to read-in HTTP requests and send-out responses (as server).</p>
<p>The table <code>opt</code> can contain:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>port</code></td>
<td style="text-align: left;">server’s port (optional; if client)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>https</code></td>
<td style="text-align: left;"><code>true</code> if using TLS</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>max_line_size</code></td>
<td style="text-align: left;">change the HTTP line size limit</td>
</tr>
</tbody>
</table>
<h3 id="client-side-api">Client-side API</h3>
<h4 id="httpmake_requestopt---req"><code>http:make_request(opt) -&gt; req</code></h4>
<p>Make a HTTP request object. The table <code>opt</code> can contain:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>host</code></td>
<td style="text-align: left;">vhost name</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>max_line_size</code></td>
<td style="text-align: left;">change the HTTP line size limit</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>close</code></td>
<td style="text-align: left;">close the connection after replying</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>content</code>, <code>content_size</code></td>
<td style="text-align: left;">body: string, read function or cdata buffer</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>compress</code></td>
<td style="text-align: left;"><code>false</code>: don’t compress body</td>
</tr>
</tbody>
</table>
<h4 id="httpsend_requestreq---true-nilerrerrtype"><code>http:send_request(req) -&gt; true | nil,err,errtype</code></h4>
<p>Send a request.</p>
<h4 id="httpread_responsereq---res-nilerrerrtype"><code>http:read_response(req) -&gt; res | nil,err,errtype</code></h4>
<p>Receive server’s response.</p>
<h3 id="server-side-api">Server-side API</h3>
<h4 id="httpread_requestreceive_content---req"><code>http:read_request(receive_content) -&gt; req</code></h4>
<p>Receive a client’s request.</p>
<h4 id="httpmake_responsereq-opt---res"><code>http:make_response(req, opt) -&gt; res</code></h4>
<p>Construct a HTTP response object.</p>
<p>The <code>opt</code> table can contain:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>close</code></td>
<td style="text-align: left;">close the connection (and tell client to)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>content</code>, <code>content_size</code></td>
<td style="text-align: left;">body: string, read function or cdata buffer</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>compress</code></td>
<td style="text-align: left;"><code>false</code>: don’t compress body</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>allowed_methods</code></td>
<td style="text-align: left;">allowed methods: <code>{method-&gt;true}</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>content_type</code></td>
<td style="text-align: left;">preferred content type</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>content_types</code></td>
<td style="text-align: left;">available content types: <code>{content_type1,...}</code></td>
</tr>
</tbody>
</table>
<h4 id="httpsend_responseres---true-nilerrerrtype"><code>http:send_response(res) -&gt; true | nil,err,errtype</code></h4>
<p>Send a response.</p>
