<!DOCTYPE html>
<html>
<head>
<title>Donut Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
.shadow {
	filter: drop-shadow(5px 5px 5px #222);
}
html, body {
	width: 100%;
	height: 100%;
	margin: 0;
	padding: 0;
	font-family: sans-serif;
}
body {
	display: flex;
	justify-content: center;
}
#main {
	display: flex;
	flex-flow: column;
	overflow: hidden;
}
#logo {
	margin: 20px 0 40px 0;
	max-width: 40%;
	z-index: 1;
	align-self: center;
	filter: drop-shadow(2px 2px 2px #222);
	pointer-events: none;
}
#product_viewport {
	margin-top: -120px;
	flex: 1;
	position: relative;
	display: flex;
	touch-action: none;
}
#product_list {
	position: relative;
	display: flex;
}
#product_list:not(.swiping) {
	transition: left .1s;
}
.product_image {
	display: none;
	object-fit: contain;
	filter: drop-shadow(5px 5px 5px #222);
}
.order_bar {
	background: rgb(255, 206, 111);
	color: white;
}
#cart {
	padding: 10px 5px;
	z-index: 2;
}
.product_image_cart {
	height: 50px;
	filter: drop-shadow(2px 2px 2px #222);
}
#order_bar {
	height: 60px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	border-top: 1px solid #999;
}
#totals {
	padding: 20px 20px;
	display: grid;
	grid: auto / auto auto;
}
#order_btn {
	font-size: 30px;
	margin: 0 20px;
}
.total {
	font-size: 24px;
}
.discount {
	font-size: 14px;
}
#total {
	justify-self: right;
}
#discount {
	justify-self: right;
}
#footer {
	padding: 10px 20px;
	background: rgb(51, 51, 51);
	color: white;
	font-size: 14px;
	line-height: 1.5em;
	min-height: 40px;
	display: flex;
	justify-content: space-between;
}
#footer_left {
	flex: 1;
}
#footer_right {
	text-align: right;
}
</style>
<script src="glue.js"></script>
<script src="divs.js"></script>
</head>
<body>
	<div id=main>
		<img id=logo src=logo.png>
		<div id=product_viewport>
			<div id=product_list>
				<img class=product_image src=1.png>
				<img class=product_image src=2.png>
				<img class=product_image src=3.png>
			</div>
		</div>
		<div id=cart class=order_bar>
			<img class=product_image_cart src=1.png>
			<img class=product_image_cart src=2.png>
			<img class=product_image_cart src=3.png>
			<img class=product_image_cart src=2.png>
			<img class=product_image_cart src=3.png>
		</div>
		<div id=order_bar class=order_bar>
			<div id=totals>
				<div class=total>Total</div>
				<div class=total id=total>120</div>
				<div class=discount>Discount</div>
				<div class=discount id=discount>120</div>
			</div>
			<div id=order_btn>COMANDA</div>
		</div>
		<div id=footer>
			<div id=footer_left>
				<div>Events / Corporate</div>
				<div>Contact</div>
			</div>
			<div id=footer_right>
				<img src=facebook.png style="width: 50%">
			</div>
		</div>
	</div>
<script>

p = [
	{
		title: 'Box o\'donuts',
		id: 1,
	},
	{
		title: 'Sweet donut',
		id: 2,
	},
	{
		title: 'Even sweeter',
		id: 3,
	},
]

// product image fit container height ----------------------------------------

function resize_product_image(p) {
	let w0 = p.naturalWidth
	let h0 = p.naturalHeight
	let w = product_viewport.clientWidth
	let h = product_viewport.clientHeight
	p.h = min(w, h)
	p.w = min(w, h)
	p.style.display = 'flex'
	select_product(selected_product_index)
}
function product_image_loaded(ev) {
	resize_product_image(this)
}
for (let p of product_list.children)
	p.onload = product_image_loaded

document.on('layout_changed', function() {
	for (let p of product_list.children)
		p.hide()
	for (let p of product_list.children)
		resize_product_image(p)
})

// product selection ---------------------------------------------------------

selected_product_index = 0

function select_product(index) {
	index = clamp(index, 0, product_list.at.length - 1)
	selected_product_index = index
	let x = 0
	for (let i = 0; i < index; i++) {
		let p = product_list.at[i]
		x += p.offsetWidth
	}
	product_list.x = -x
		- product_list.at[index].offsetWidth / 2
		+ product_viewport.clientWidth / 2
}

document.on('keydown', function(key) {
	if (key == 'ArrowLeft' || key == 'ArrowRight') {
		select_product(selected_product_index += (key == 'ArrowLeft' ? -1 : 1))
		return false
	}
})

product_viewport.on('pointerdown', function(ev, mx, my) {
	let x0 = product_list.offsetLeft
	let dx = mx - this.client_rect().x - x0
	function pointermove(mx, my) {
		mx -= this.client_rect().x
		product_list.x = mx - dx
		return false
	}
	function pointerup() {
		product_list.class('swiping', false)
		let i = selected_product_index + (product_list.offsetLeft <= x0 ? 1 : -1)
		select_product(i)
		return false
	}
	product_list.class('swiping', true)
	return this.capture_pointer(ev, pointermove, pointerup)
})

</script>
</body>
</html>
